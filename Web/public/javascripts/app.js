// Generated by CoffeeScript 1.8.0
(function() {
  var app;

  app = angular.module("Roughs", ["ngMaterial"]);

  app.controller("ProjectListController", [
    "$scope", "$http", "$mdDialog", "$mdToast", function($scope, $http, $mdDialog, $mdToast) {
      var showErrorDialog;
      showErrorDialog = function(data) {
        return $mdDialog.show({
          templateUrl: "/components/ErrorDialog.tmpl.html",
          controller: "ErrorDialogController",
          locals: {
            data: data
          }
        });
      };
      $scope.projects = [];
      $scope.postProject = function(pURL) {
        return $http.post("/api/projects", {
          "project_url": pURL
        }).success(function(data, status, headers, config) {
          $mdToast.show({
            template: "<md-toast>Added \"" + data["title"] + "\"</md-toast>"
          });
          return $scope.projects.splice(0, 0, data);
        }).error(function(data, status, headers, config) {
          return showErrorDialog(data);
        });
      };
      $scope.deleteProject = function($event, $index) {
        $event.stopPropagation();
        return $mdDialog.show({
          targetEvent: $event,
          templateUrl: "/components/ComfirmDialog.tmpl.html",
          controller: "ConfirmDialogController",
          locals: {
            title: "Remove Project",
            message: "Are you sure remove this project?"
          }
        }).then(function() {
          var project;
          console.log(arguments);
          project = $scope.projects[$index];
          return $http["delete"]("/api/projects/" + project["id"]).success(function(data, status, headers, config) {
            $mdToast.show({
              template: "<md-toast>Removed \"" + project["title"] + "\"</md-toast>"
            });
            return $scope.projects.splice($index, 1);
          }).error(function() {
            return showErrorDialog(data);
          });
        }, function() {
          return console.log(arguments);
        });
      };
      $scope.openProject = function($index) {
        var project;
        project = $scope.projects[$index];
        return window.open(project["project_url"], "_blank");
      };
      return $http.get("/api/projects/all").success(function(data, status, headers, config) {
        return $scope.projects = data;
      }).error(function() {
        return $mdDialog.show();
      });
    }
  ]);

  app.controller("ConfirmDialogController", function($scope, $mdDialog, title, message) {
    $scope.title = title;
    $scope.message = message;
    $scope.ok = function() {
      return $mdDialog.hide();
    };
    return $scope.cancel = function() {
      return $mdDialog.cancel();
    };
  });

  app.controller("ErrorDialogController", function($scope, $mdDialog, data) {
    $scope.message = data.name;
    return $scope.ok = function() {
      return $mdDialog.cancel();
    };
  });

}).call(this);
